# HTTP 面试记录

## HTTP 版本区别

### HTTP/0.9

1. 只允许GET
2. 响应后立即关闭连接
3. 只允许文本

### HTTP/1.0(备忘录性质, 不具有强制约束)

1. 增加了HEAD POST等新方法
2. 增加了响应状态码, 标记可能的错误原因
3. 引入了协议版本号概念
4. 引入了HTTP Header(头部)的概念, 让HTTP处理请求和响应更加灵活(?)
5. 传输的数据不仅限于文本

### HTTP/1.1(RFC2616)

2014年修订, 拆分6个小文档, RFC7230-7235, 无实质改动

1. 增加了PUT DELETE等新方法
2. 增加了缓存管理和控制
3. 明确了连接管理, 允许持久连接
4. 允许响应数据分块(chunked), 利于传输大文件
5. 强制要求Host头, 让互联网主机托管成为可能(?)

### HTTP/2(RFC7540)

解决问题: 宽带 移动 不安全, 兼容1.1

1. 二进制协议, 不再是纯文本
2. 可发起多个请求, 废弃1.1的管道
3. 使用专用算法压缩头部, 减少数据传输
4. 允许服务器主动向客户端推送数据
5. 增强安全性, "事实上"要求加密通信

## HTTP协议认识

> HTTP是一个在计算机世界里专门在两点间传输文字/图片/音频/视频等超文本数据的约定和规范

### 协议

> HTTP是一个用在计算机世界的协议, 使用计算机理解的语言确立一种计算机间交流通信的规范, 以及相关的控制和错误处理方式

### 传输

> HTTP是一个在计算机世界里专门用来在两点间传输数据的约定和规范

- 双向协议, 请求方/响应方
- 数据在A/B间传输, 但不限制于仅A/B, 运行有`中转`或`接力`, 即`中间人`, 如安全认证/数据压缩/编码转换等, 优化传输过程

### 超文本

`文本(Text)`是完整 有意义的数据, 可以被浏览器/服务器等上层应用处理, 对比: TCP/UDP中为切分后的`二进制(datagram)`

`超文本`, 包含文字/图片/音频/视频等混合体, 关键是含有`超链接`, 在超文本间跳跃, 形成复杂的非线性/网状结构关系, 例如`HTML`

## CDN

内容分发网络(Content Delivery Network), 应用HTTP中的缓存和代理技术, 代替源站响应客户端的请求

## TCP

位于IP协议之上, 基于IP协议提供可靠的、字节流形式的通信

- 可靠,保证数据不丢失
- 字节流,保证数据完整性

## DNS

`域名（Domain Name）`又称为`主机名（Host)`

## 分层模型

下述层次指OSI7层模型层次

- 四层负载均衡: 指工作在传输层上，基于 TCP/IP 协议的特性，例如 IP 地址、端口号等实现对后端服务器的负载均衡。
- 七层负载均衡: 指工作在应用层上，看到的是 HTTP 协议，解析 HTTP 报文里的 URI、主机名、资源类型等数据，再用适当的策略转发给后端服务器。
- 二层转发：设备工作在链路层，帧在经过交换机设备时，检查帧的头部信息，拿到目标mac地址，进行本地转发和广播
- 三层路由：设备工作在网络(ip)层，报文经过有路由功能的设备时，设备分析报文中的头部信息，拿到ip地址，根据网段范围，进行本地转发或选择下一个网关

UNIX域套接字可以认为在五层

### TCP和UDP区别

- TCP 有状态 需要先建立连接才能发送数据 保证数据不丢失不重复 数据是连续的字节流，有先后顺序
- UDP 无状态 不需要先建立连接也可以发送数据 不保证数据一定会发送到对方 数据是分散的小数据包，顺序发、乱序收

## 09 HTTP报文格式

    起始行      start line
    头部        header
    空行        CRLF(0x0D0A)
    实体        entity body

### 请求行(request line)

描述**客户端想要如何操作服务端的资源**

> SP -> space, CRLF -> /r/n

    Method/SP/URI/SP/Version/CRLF

1. 请求方法: 动词, GET/POST, 表示对资源的操作
2. 请求目标: URI, 标记请求方法要操作的资源
3. 版本号: HTTP协议版本

### 状态行(status line)

描述**服务器响应的状态**

> SP -> space, CRLF -> /r/n

    Version/SP/Status Code/SP/Reason/CRLF

1. 版本号: HTTP协议版本
2. 状态码: 三位数, 表示处理结果
3. 原因: 状态码的补充, 更详细的解释文字

### 头部字段

    Field Name: Field Value/CRLF

1. 字段名不区分大小写, 但首字母大写可读性好
2. 字段名不允许(RFC)空格, 可以使用'-', 不能使用'_'(但是可以强行使用, 如Nginx的`underscores_in_headers on`)
3. 名称后紧跟':', 但是':'后可以有多个空格
4. 字段顺序不要求
5. 字段原则上不能重复, 除非字段本身语义运行, 如`Set-Cookie`

### 常用头字段

1. 通用字段：在请求头和响应头里都可以出现
2. 请求字段：仅能出现在请求头里，进一步说明请求信息或者额外的附加条件
3. 响应字段：仅能出现在响应头里，补充说明响应报文的信息
4. 实体字段：它实际上属于通用字段，但专门描述 body 的额外信息

- Host: 请求字段, `HTTP/1.1`中唯一要求必须出现的字段, 一般是域名, 当一个服务器托管了多个虚拟主机(域名), 需要靠此字段区分
- User-Agent: 请求字段, 描述发起的客户端
- Date: 通用字段, 但常出现在响应头, 表示HTTP报文创建时间, 客户端可以据此搭配其他字段决定缓存策略
- Server: 响应字段, 表示当前Web服务的软件和版本号, 不是必须出现, 会暴露服务器信息
- Content-Length: 实体字段, 表示body长度, 可以直接接收, 没有表示body不定长, 需要使用`chunked`方式分段传输

## 10 请求方法

- 幂等: GET HEAD DELETE PUT
- 非幂等: POST

## 11 URI

### 编码

非ASCII直接转义为16进制, 然后前面加`%`, CJK转为UTF-8编码后再转义

## 12 响应状态码

### 2XX

- `200 OK`
- `204 No Content`, 响应头后没有body
- `206 Partial Content`, 分块下载或断点续传的基础, 伴随头字段`Content-Range`, `Content-Range: byte 0-99/2000`, 总计2000, 目前0-99块

### 3XX

- `301 Moved Permanently`, 永久重定向, 资源不存在, 使用新URI访问, 字段`Location`指明, 如http升级https
- `302 Found`, 临时重定向, 资源存在, 临时访问新URI, 字段`Location`指明, 如临时维护, 指定静态通知页面, 涉及缓存优化
- `304 Not Modified`, 资源未修改, 缓存控制

### 4XX

- `400 Bad Request`, 通用错误码, 尽量避免使用
- `403 Forbidden`, 服务器禁止访问资源
- `404 Not Found`, 资源在服务器未找到
- `405 Method Not Allowed`, 不允许使用使用某些方法操作资源，例如不允许POST, 只能GET
- `406 Not Acceptable`, 资源⽆法满⾜客户端请求的条件，例如请求中⽂但只有英⽂
- `408 Request Timeout`, 请求超时，服务器等待了过⻓的时间
- `409 Conflict`, 多个请求发⽣了冲突，可以理解为多线程并发时的竞态
- `413 Request Entity Too Large`, 请求报⽂⾥的body太⼤
- `414 Request URI Too Large`, 请求报⽂⾥的URI太⼤
- `429 Too Many Requests`, 客户端发送请求过多, 通常是由于服务器的限连策略
- `431 Request Header Field Too Large`, 请求头过大

### 5XX

- `500 Internal Server Error`, 通用的错误码
- `501 Not Implemented`, 客户端请求的功能还不支持, 即将完成
- `502 Bad Gateway`, 网关或代理返回的错误, 表示代理正常, 后端错误
- `503 Service Unavailable`, 服务器忙, 暂时无法响应, 是临时状态, 通常伴随`Retry-After`字段, 指明多久后客户端可以再次尝试
